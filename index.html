animateToken(playerIndex, fromPos, toPos) {
  return new Promise(resolve => {
    const token = this.playerTokens[playerIndex];
    if (!token || fromPos === toPos) {
      console.log(`Animation skipped for Player ${playerIndex + 1}: fromPos=${fromPos}, toPos=${toPos}`);
      return resolve();
    }

    const fromCoords = this.getCellCoordinates(fromPos);
    const toCoords = this.getCellCoordinates(toPos);
    const dx = toCoords.x - fromCoords.x;
    const dy = toCoords.y - fromCoords.y;

    const fromOffset = this.getTokenOffset(playerIndex, fromPos);
    const toOffset = this.getTokenOffset(playerIndex, toPos);

    console.log(`Animating Player ${playerIndex + 1} from ${fromPos} to ${toPos}, dx=${dx}, dy=${dy}, fromOffset=${fromOffset}, toOffset=${toOffset}`);

    token.style.transform = `translate(${dx - 50 + fromOffset}%, ${dy - 50}%)`;

    const onTransitionEnd = () => {
      token.removeEventListener('transitionend', onTransitionEnd);
      clearTimeout(timeout);
      this.cells[toPos].appendChild(token);
      token.style.transform = `translate(-50%, -50%) translateX(${toOffset}px)`;
      console.log(`Animation completed for Player ${playerIndex + 1} to position ${toPos}`);
      resolve();
    };

    const timeout = setTimeout(() => {
      token.removeEventListener('transitionend', onTransitionEnd);
      this.cells[toPos].appendChild(token);
      token.style.transform = `translate(-50%, -50%) translateX(${toOffset}px)`;
      console.warn(`Animation timeout for Player ${playerIndex + 1}, forcing completion to position ${toPos}`);
      resolve();
    }, 1000);

    token.addEventListener('transitionend', onTransitionEnd, { once: true });
  });
}
